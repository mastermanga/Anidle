<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Animedle</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #f0f0f0;
      text-align: center;
      padding: 20px;
    }
    input[type="text"] {
      padding: 10px;
      font-size: 16px;
      width: 300px;
      border-radius: 5px;
      border: none;
    }
    .suggestions {
      background: #1e1e1e;
      border: 1px solid #333;
      max-width: 300px;
      margin: 0 auto 10px;
      text-align: left;
    }
    .suggestions div {
      padding: 8px;
      cursor: pointer;
    }
    .suggestions div:hover {
      background-color: #333;
    }
    .row {
      display: flex;
      justify-content: center;
      margin-bottom: 5px;
      flex-wrap: wrap;
    }
    .cell {
      padding: 8px;
      margin: 2px;
      min-width: 160px;
      max-width: 240px;
      word-wrap: break-word;
      border-radius: 4px;
      background-color: #2a2a2a;
      border: 1px solid #444;
      text-align: left;
    }
    .green {
      background-color: #4caf50 !important;
      color: white;
    }
    .red {
      background-color: #f44336 !important;
      color: white;
    }
    .orange {
      background-color: orange !important;
      color: black;
    }
    #counter {
      margin-bottom: 10px;
    }
    #winMessage {
      font-size: 20px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Animedle ðŸŽ®</h1>
  <input type="text" id="animeInput" placeholder="Entrez un anime..." />
  <div id="suggestions" class="suggestions"></div>
  <div id="counter">Tentatives : 0</div>
  <div id="results"></div>
  <button onclick="resetGame()">ðŸ”„ Rejouer</button>

  <script>
    let animeData = [];
    let targetAnime = null;
    let attemptCount = 0;
    let gameOver = false;

    fetch('animes.json')
      .then(res => res.json())
      .then(data => {
        animeData = data;
        targetAnime = animeData[Math.floor(Math.random() * animeData.length)];
        console.log("Cible:", targetAnime);
      });

    document.getElementById("animeInput").addEventListener("input", function () {
      const input = this.value.toLowerCase();
      const matches = animeData.filter(a => a.title.toLowerCase().includes(input)).slice(0, 5);
      const suggestions = document.getElementById("suggestions");
      suggestions.innerHTML = "";
      matches.forEach(anime => {
        const div = document.createElement("div");
        div.textContent = anime.title;
        div.onclick = () => {
          document.getElementById("animeInput").value = anime.title;
          suggestions.innerHTML = "";
          guessAnime();
        };
        suggestions.appendChild(div);
      });
    });

    function guessAnime() {
      if (gameOver) return;
      const input = document.getElementById("animeInput").value.trim();
      const guessedAnime = animeData.find(a => a.title.toLowerCase() === input.toLowerCase());

      if (!guessedAnime) {
        alert("Anime non trouvÃ© !");
        return;
      }

      attemptCount++;
      document.getElementById("counter").textContent = "Tentatives : " + attemptCount;

      const results = document.getElementById("results");

      if (attemptCount === 1) {
        const header = document.createElement("div");
        header.classList.add("row");
        ["Titre", "Saison", "Studio", "Genres", "ThÃ¨mes", "Score"].forEach(label => {
          const cell = document.createElement("div");
          cell.classList.add("cell");
          cell.style.fontWeight = "bold";
          cell.textContent = label;
          header.appendChild(cell);
        });
        results.appendChild(header);
      }

      const row = document.createElement("div");
      row.classList.add("row");

      ["title", "season", "studio", "genres", "themes", "score"].forEach(key => {
        const cell = document.createElement("div");
        cell.classList.add("cell");

        if (key === "score") {
          const guessed = parseFloat(guessedAnime.score);
          const target = parseFloat(targetAnime.score);
          if (guessed === target) {
            cell.classList.add("green");
          } else {
            cell.textContent = `${guessed} ${guessed < target ? "ðŸ”¼" : "ðŸ”½"}`;
            cell.classList.add("red");
          }
          if (guessed === target) cell.textContent = guessed;
        } else if (key === "genres" || key === "themes") {
          const guessedSet = new Set(guessedAnime[key]);
          const targetSet = new Set(targetAnime[key]);
          const intersection = [...guessedSet].filter(x => targetSet.has(x));

          if (intersection.length === 0) {
            cell.classList.add("red");
          } else if (intersection.length < targetSet.size || guessedSet.size > targetSet.size) {
            cell.classList.add("orange");
          } else {
            cell.classList.add("green");
          }
          cell.textContent = guessedAnime[key].join(", ");
        } else if (key === "season") {
          const g = guessedAnime[key].toLowerCase();
          const t = targetAnime[key].toLowerCase();
          const gYear = g.split(" ")[1];
          const tYear = t.split(" ")[1];

          if (g === t) {
            cell.classList.add("green");
          } else if (gYear === tYear) {
            cell.classList.add("orange");
          } else {
            cell.classList.add("red");
          }
          cell.textContent = guessedAnime[key];
        } else if (key === "title") {
          cell.innerHTML = `<img src="${guessedAnime.image}" alt="img" style="width:40px;height:60px;object-fit:cover;vertical-align:middle;margin-right:5px;border-radius:4px;"> ${guessedAnime.title}`;
          cell.classList.add(guessedAnime.title === targetAnime.title ? "green" : "red");
        } else {
          const isMatch = guessedAnime[key] === targetAnime[key];
          cell.classList.add(isMatch ? "green" : "red");
          cell.textContent = guessedAnime[key];
        }

        row.appendChild(cell);
      });

      // Inverser l'ordre : ajoute en haut
      results.insertBefore(row, results.children[1]);

      document.getElementById("animeInput").value = "";
      document.getElementById("suggestions").innerHTML = "";

      if (guessedAnime.title === targetAnime.title) {
        gameOver = true;
        document.getElementById("animeInput").disabled = true;
        const winMsg = document.createElement("div");
        winMsg.id = "winMessage";
        winMsg.innerHTML = `ðŸŽ‰ Bravo ! C'Ã©tait <b>${targetAnime.title}</b> en ${attemptCount} tentative${attemptCount > 1 ? "s" : ""}.`;
        results.insertBefore(winMsg, results.children[1]);
      }
    }

    function resetGame() {
      location.reload();
    }
  </script>
</body>
</html>

